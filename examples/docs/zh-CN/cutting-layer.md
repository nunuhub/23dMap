## CuttingLayer 图层裁剪

裁剪目标图层，只显示裁剪区域内或区域外图形

### 基础用法

基础的查询弹窗用法。

:::demo

```html
<template>
  <div style="height:100%;width:100%">
    <sh-map-earth>
      <sh-layer-manager :isShow="false" :layersInfo="layerInfos" />
      <sh-cutting-layer :cuttingOptions="cuttingOptions" />
    </sh-map-earth>
  </div>
</template>
<script>
  export default {
    data() {
      this.layerInfos = [
        {
          showIndex: 1,
          parent: null,
          initChecked: 'false',
          id: '00000001000100060001000000000000',
          label: '图层目录',
          tp: 'directory',
          guid: 'db125b76-5a90-2e5e-598c-6158173707b0',
          editing: false
        },
        {
          showIndex: 8,
          parent: '00000001000100060001000000000000',
          serverOrigin: 'other',
          identifyField: [],
          mapIndex: 4,
          geotype: 'polygon',
          mobile: false,
          label: '天地图电子地图',
          mobileOpacity: false,
          type: 'tdt',
          url: 'http://t0.tianditu.gov.cn/vec_c/wmts?tk=17d1619c13e4508bc1945bd59de4edf8',
          visibleLayers: ['vec'],
          isUserPictureLegend: false,
          topologyCheck: '0',
          layerTag: 'TDT_vec',
          selectLayer: '',
          isSwitch: false,
          isFilter: false,
          initChecked: true,
          id: 'b780289b293a409c8046e7983017fa4c',
          opacity: 1,
          showInfoWindow: true,
          tp: 'layer',
          group: '1',
          guid: 'bc7f75a4-5c28-08f3-d95e-cf8abc2c43d2',
          editing: false
        }
      ];
      return {
        cuttingOptions: {
          geoJson:
            '{"geometry":{"crs":{"type":"name","properties":{"name":"EPSG:4490"}},"coordinates":[[[[116.675274015,41.040102005],[116.692696575,41.01914545],[116.671657875,40.969620025],[116.71452504,40.92445326],[116.707287055,40.908709405],[116.77421404,40.87453057],[116.798794285,40.838900695],[116.814604845,40.84675521],[116.86944745,40.820062595],[116.890544905,40.795390455],[116.886433555,40.778971425],[116.919079005,40.77152119],[116.91776585,40.748708755],[116.96280053,40.70616155],[117.021702265,40.69219835],[117.10241902,40.705571365],[117.199522915,40.69305228],[117.28494815,40.65866709],[117.402564395,40.685670355],[117.50823921,40.659284175],[117.49387494,40.634755405],[117.455320185,40.65150659],[117.442190935,40.649855328],[117.440354195,40.62666396],[117.41443292,40.633823235],[117.414967498,40.567769205],[117.38092106,40.5592185],[117.339855415,40.580421475],[117.30478051,40.575831485],[117.24310196,40.54681194],[117.256955275,40.51182911],[117.21226876,40.51295829],[117.20156223,40.49849684],[117.25558527,40.439038905],[117.22871841,40.415954675],[117.21759624,40.370071415],[117.26840349,40.331347078],[117.28923982,40.276918875],[117.325344325,40.28831446],[117.33903784,40.23498537],[117.383350145,40.226472315],[117.370887296,40.217142289],[117.38659348,40.202430125],[117.37319714,40.200549805],[117.37720543,40.18650924],[117.40026784,40.184688105],[117.34496927,40.171735925],[117.353991065,40.155601828],[117.34121694,40.134537905],[117.307122405,40.138625658],[117.291128415,40.117683245],[117.233228215,40.11150478],[117.193428395,40.067130945],[117.17927172,40.083599625],[117.17430497,40.068626695],[117.13268681,40.06264672],[117.07908386,40.07370536],[117.015539355,40.02838394],[116.955873495,40.050229455],[116.8649858,40.03921931],[116.844521415,40.05388455],[116.80925449,40.029719605],[116.773436525,40.03333951],[116.75112772,39.96126859],[116.77756895,39.9425794],[116.780037115,39.885150215],[116.798095,39.876908515],[116.80626563,39.888510303],[116.841102575,39.8539142],[116.89652532,39.830005125],[116.898359475,39.85007194],[116.913513647,39.845819189],[116.939632775,39.7848897],[116.895718658,39.76228876],[116.90952787,39.73031019],[116.87670966,39.717535865],[116.90065225,39.676610905],[116.844003218,39.66651745],[116.845396895,39.6514213],[116.817947184,39.634023553],[116.83255726,39.621112225],[116.78399647,39.609353385],[116.778969325,39.592281705],[116.71941419,39.62296106],[116.69464879,39.6198652],[116.720772815,39.594896735],[116.69919103,39.586817985],[116.664207785,39.603815745],[116.61476827,39.60065501],[116.601981763,39.623835673],[116.56016503,39.61873732],[116.557734125,39.60260221],[116.519872185,39.59560137],[116.502394785,39.549617568],[116.467146245,39.55189106],[116.47167603,39.53497297],[116.430648355,39.525000405],[116.437678848,39.50853704],[116.39648289,39.52553166],[116.417105469,39.495208433],[116.40573706,39.480601535],[116.43800795,39.48088561],[116.449905386,39.45806084],[116.428672128,39.442110118],[116.3278418,39.45467055],[116.29932036,39.48822529],[116.25293498,39.49893112],[116.240044665,39.55625158],[116.19799828,39.587579295],[116.130455365,39.567184565],[116.095101477,39.578648828],[116.0292022,39.570372105],[116.010181693,39.58695174],[115.98915716,39.575933745],[115.97210337,39.59315229],[115.97216999,39.571752215],[115.95161745,39.559885295],[115.904447215,39.599717885],[115.90696492,39.572009945],[115.884540845,39.56761816],[115.88161666,39.549778855],[115.84951708,39.553958685],[115.81312259,39.52977618],[115.822644855,39.50598617],[115.745982215,39.51291257],[115.73233935,39.545178935],[115.686293692,39.565394295],[115.681934995,39.599877925],[115.661292307,39.614383864],[115.65096044,39.59870203],[115.575117255,39.58840203],[115.539587675,39.61771023],[115.508198495,39.59080897],[115.516193723,39.63886918],[115.471819225,39.65103643],[115.492611115,39.688557595],[115.48624514,39.7372423],[115.433920915,39.75040274],[115.41835508,39.773152285],[115.47704185,39.797488335],[115.500607295,39.78236687],[115.54591397,39.793585505],[115.563230075,39.812757305],[115.50711404,39.8406565],[115.522458005,39.871057205],[115.502759545,39.882995235],[115.51428854,39.90102958],[115.474594135,39.934338348],[115.419701315,39.94904032],[115.447813095,40.028128985],[115.557787505,40.097109435],[115.584622875,40.095363305],[115.59223994,40.118135905],[115.72982567,40.1287218],[115.771413725,40.176621995],[115.80037153,40.15207902],[115.84584817,40.146944495],[115.842032995,40.182910053],[115.865884095,40.18619695],[115.892502685,40.233447215],[115.961814695,40.26241292],[115.91232269,40.35281061],[115.853218045,40.36127343],[115.854346475,40.37454103],[115.764540545,40.44130947],[115.775745915,40.491702945],[115.72954183,40.502663505],[115.746648755,40.534951535],[115.78436727,40.559606445],[115.813830135,40.558208585],[115.8215553,40.58605515],[115.87993669,40.59475779],[115.90178683,40.616094435],[115.9607346,40.60501525],[115.97731206,40.577464885],[116.022062025,40.605816505],[116.024865685,40.596016745],[116.115324605,40.62756812],[116.104904375,40.6456581],[116.128478345,40.66549399],[116.1583292,40.66182665],[116.17293208,40.7075035],[116.24150188,40.79027903],[116.302458285,40.75043354],[116.311375725,40.770603135],[116.455422705,40.768117025],[116.43107621,40.81866787],[116.328186005,40.90291822],[116.33414979,40.92868913],[116.364003745,40.94185642],[116.392566265,40.9041455],[116.467808395,40.89430494],[116.44922991,40.97805543],[116.51019839,40.97355109],[116.557372885,40.992091625],[116.592877095,40.973234295],[116.60995845,40.985502415],[116.611469555,41.050227125],[116.641443555,41.057787765],[116.675274015,41.040102005]]]],"type":"MultiPolygon"},"type":"Feature","properties":{"xzqmc":"北京市","xzqdm":110000}}', //要裁剪区域的geoJson
          isMask: true,
          stopMoveListener: false, //地图拖动状态下,停止裁剪(避免卡顿)
          // maskType: 'pruning'//扣除
          maskType: 'pruning', //fill填充,pruning扣除
          maskIndex: 1099, //遮罩层压盖顺序
          //被裁剪的图层ids(已加载的图层)
          targetLayers: ['b780289b293a409c8046e7983017fa4c'],
          geoLayer: {},
          //遮罩层样式配置
          maskConfig: {
            fillColor: 'rgba(0, 0, 0, 0.6)', //遮罩颜色
            strokeColor: 'rgba(255, 69, 0, 1)', //遮罩边界线颜色
            strokeWidth: 2 //边界线粗细
          },
          //是否固定地图裁剪的位置以及缩放级别
          locateConf: {
            isLocate: false,
            center: '', //固定位置中心点(非必须)
            resolution: '' //当前地图缩放级别(非必须)
          }
        }
      };
    }
  };
</script>
```

:::

### Attributes

| 参数           | 属性类型 | 类型    | 可选值 | 默认值 | 说明               |
| -------------- | -------- | ------- | ------ | ------ | ------------------ |
| isShow         | 动态属性 | boolean | -      | true   | 默认按钮是否展示   |
| defaultActive  | 静态属性 | boolean | -      | false  | 功能是否默认打开   |
| cuttingOptions | 静态属性 | Object  | 必传   | -      | 裁剪初始化参数对象 |

#### Attributes -> cuttingOptions 参数详情

| 参数             | 属性类型 | 类型    | 可选值         | 默认值  | 说明                                                                                           |
| ---------------- | -------- | ------- | -------------- | ------- | ---------------------------------------------------------------------------------------------- |
| geoJson          | 静态属性 | json    | -              | -       | 裁剪区域的边界数据, 与 geoLayer 二选一                                                         |
| geoLayer         | 静态属性 | object  | -              | -       | 根据提供的服务,内部查询裁剪区域的边界数据, 与 geoJson 二选一                                   |
| stopMoveListener | 静态属性 | boolean | -              | false   | 地图拖动状态下,停止裁剪(避免卡顿)                                                              |
| isMask           | 静态属性 | boolean | -              | false   | 是否启用遮罩                                                                                   |
| maskIndex        | 静态属性 | number  | -              | 1099    | 遮罩层压盖顺序                                                                                 |
| maskType         | 静态属性 | string  | pruning / fill | pruning | 遮罩类型(裁剪区域以外部分/当前裁剪区域部分)                                                    |
| targetLayers     | 静态属性 | array   | -              | -       | 必填。当前需要被裁剪的图层 id 数组(已经加载的图层)                                             |
| maskConfig       | 静态属性 | object  | -              | -       | 遮罩样式                                                                                       |
| locateConfig     | 静态属性 | object  | -              | -       | 是否缩放,或者固定地图裁剪的位置以及缩放级别,isLocate=true 时,center 与 resolution 需要同时满足 |

#### cuttingOptions 参数示例

```javascript
widgetInfo = {
  geoJson: '', //要裁剪区域的geoJson
  isMask: true,
  stopMoveListener: false, //地图拖动状态下,停止裁剪(避免卡顿)
  // maskType: 'pruning'//扣除
  maskType: 'fill', //fill填充,pruning扣除
  maskIndex: 1099, //遮罩层压盖顺序
  //被裁剪的图层ids(已加载的图层)
  targetLayers: [
    'f8d3717c-e84d-1f5c-b8af-b17c2f319b5f2D电子地图',
    '35f38315-c80e-cf6a-683b-917c82b67a712D电子地图'
  ],
  //非geojson数据时,提供可查询到裁剪区域的服务数据,并自定义查询CQL
  geoLayer: {
    layer: {
      //图层信息
      visibleLayers: ['fgy:kj000101a'], //geoserver: [post:xzqh], arcgis不用
      type: 'dynamic', //'geoserver-wfs'
      // url: 'http://223.4.76.89:8000/geoserver/fgy/wms',
      url: 'http://192.168.11.148:6080/arcgis/rest/services/%E8%A1%8C%E6%94%BF%E5%8C%BA%E5%AF%BC%E8%88%AA/MapServer',
      serverOrigin: 'arcgis'
    },
    whereInfo: "xzqdm='3301'" //非geoJson时,自定义服务以及查询CQL
  },
  //遮罩层样式配置
  maskConfig: {
    fillColor: 'rgba(0, 0, 0, 0.6)', //遮罩颜色
    strokeColor: 'rgba(255, 69, 0, 1)', //遮罩边界线颜色
    strokeWidth: 2 //边界线粗细
  },
  //是否缩放,或者固定地图裁剪的位置以及缩放级别
  //isLocate=true时,center与resolution需要同时满足
  //没有需求,可以都不传
  locateConfig: {
    isFit: false, //是否缩放,与isLocate互斥,优先级高
    isLocate: false, //是否初次固定地图位置,与isFit互斥
    center: '', //固定位置中心点(非必须)
    resolution: '' //当前地图缩放级别(非必须)
  }
};
```

### Methods

| 方法名                 | 说明                       | 参数 |
| ---------------------- | -------------------------- | ---- |
| toggle                 | 开启或关闭裁剪功能         | -    |
| activate               | 执行裁剪                   | -    |
| deactivate             | 移除所有裁剪               | -    |
| addCuttingLayerById    | 根据 id 添加裁剪图层       | -    |
| removeCuttingLayerById | 根据 id 移除裁剪图层       | -    |
| getCutLayersIds        | 获取已经裁剪的图层 id 数组 | -    |
